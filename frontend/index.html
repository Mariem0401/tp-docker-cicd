<!DOCTYPE html>
<html lang="fr">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Gestion des utilisateurs</title>
Â  <link rel="stylesheet" href="style.css" />
</head>
<body>
Â  <div class="container">
Â  Â  <h1>ðŸ‘¥ Gestion des utilisateurs</h1>

Â  Â  <form id="userForm">
Â  Â  Â  <input id="nameInput" type="text" placeholder="Nom" required />
Â  Â  Â  <input id="emailInput" type="email" placeholder="Email" required />
Â  Â  Â  <button type="submit">Ajouter</button>
Â  Â  </form>

Â  Â  <h2>Utilisateurs enregistrÃ©s</h2>
Â  Â  <div id="result">Chargement...</div>
Â  </div>

Â  <script>
Â  Â  // DÃ©finition de l'URL de base du backend dÃ©ployÃ© sur Render
Â  Â  const API_BASE_URL = 'https://tp-docker-cicd-onlr.onrender.com';

Â  Â  async function fetchUsers() {
Â  Â  Â  const resultDiv = document.getElementById('result');
Â  Â  Â  resultDiv.innerHTML = 'Chargement...';
Â  Â  Â  try {
Â  Â  Â  Â  // CHANGEMENT ICI : Utilisation de l'URL Render pour la requÃªte GET
Â  Â  Â  Â  const res = await fetch(`${API_BASE_URL}/api/users`);
Â  Â  Â  Â  
Â  Â  Â  Â  // VÃ©rification du statut HTTP pour les erreurs (comme 404, 500, etc.)
Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  throw new Error(`Ã‰chec de la rÃ©cupÃ©ration (Statut: ${res.status})`);
Â  Â  Â  Â  }

Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  
Â  Â  Â  Â  if (!Array.isArray(data)) {
Â  Â  Â  Â  Â  resultDiv.innerHTML = '<p>Erreur: rÃ©ponse inattendue du serveur.</p>';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (data.length === 0) {
Â  Â  Â  Â  Â  resultDiv.innerHTML = '<p>Aucun utilisateur pour lâ€™instant.</p>';
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const list = data
Â  Â  Â  Â  Â  .map(
Â  Â  Â  Â  Â  Â  (u) =>
Â  Â  Â  Â  Â  Â  Â  `<li><strong>${escapeHtml(u.name)}</strong> â€” ${escapeHtml(u.email)}</li>`
Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  .join('');
Â  Â  Â  Â  resultDiv.innerHTML = `<ul>${list}</ul>`;
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  // L'erreur ici sera probablement l'ancienne "Failed to fetch" si l'URL est mauvaise, 
Â  Â  Â  Â  // ou l'erreur avec le statut HTTP que nous avons ajoutÃ©e ci-dessus.
Â  Â  Â  Â  resultDiv.innerHTML = `<p style="color:red">Erreur de connexion Ã  l'API : ${err.message}</p>`;
Â  Â  Â  Â  console.error('Fetch error:', err);
Â  Â  Â  }
Â  Â  }

Â  Â  async function addUser(ev) {
Â  Â  Â  ev.preventDefault();
Â  Â  Â  const name = document.getElementById('nameInput').value.trim();
Â  Â  Â  const email = document.getElementById('emailInput').value.trim();
Â  Â  Â  if (!name || !email) return;
Â  Â  Â  try {
Â  Â  Â  Â  // CHANGEMENT ICI : Utilisation de l'URL Render pour la requÃªte POST
Â  Â  Â  Â  const res = await fetch(`${API_BASE_URL}/api/users`, {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  body: JSON.stringify({ name, email }),
Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  // VÃ©rification du statut HTTP pour les erreurs
Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  throw new Error(`Ã‰chec de l'ajout (Statut: ${res.status})`);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  document.getElementById('userForm').reset();
Â  Â  Â  Â  Â  fetchUsers(); // Recharger la liste des utilisateurs
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('Erreur : ' + (data.error || 'Inconnue'));
Â  Â  Â  Â  }
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  // GÃ©rer les erreurs de rÃ©seau ou les erreurs HTTP capturÃ©es ci-dessus
Â  Â  Â  Â  alert('Erreur rÃ©seau ou API : ' + err.message);
Â  Â  Â  }
Â  Â  }

Â  Â  function escapeHtml(str) {
Â  Â  Â  return str.replace(/[&<>"']/g, (m) => {
Â  Â  Â  Â  return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m];
Â  Â  Â  });
Â  Â  }

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  document.getElementById('userForm').addEventListener('submit', addUser);
Â  Â  Â  fetchUsers(); // Lancer la rÃ©cupÃ©ration initiale
Â  Â  });
Â  </script>
</body>
</html>
